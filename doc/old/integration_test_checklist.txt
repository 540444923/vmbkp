vmbkp 環境依存テストメモ。

--------------------------------------------------------------------------------
vmdkbkp (c++) コードの環境依存テストにおけるチェックリスト。
--------------------------------------------------------------------------------

テスト用 vm、snapshot 0, 1 を用意。

□ snapshot0, 1 の dump full の正常動作。(*1)
□ snapshot0 で nbd/san 転送の違いで、違いがないことを確認。

□ dump diff の正常動作。
□ dump diff の結果 dump が (*1) の snapshot1 結果と同じことを確認。
□ dump diff の結果 dump + rdiff が (*1) の snapshot0 結果と同じことを確認。(*3)
□ (*3) から生成した digest が (*1) のそれと同じであることを確認。

□ dump incr の正常動作。(rdiff2bmp を使用して bmpin を生成。)
□ dump incr の結果 dump が (*1) の snapshot1 結果と同じことを確認。
□ dump incr の結果 dump + rdiff が (*1) の snapshot0 結果と同じことを確認。(*4)
□ (*4) から生成した digest が (*1) のそれと同じであることを確認。

□ restore の正常動作。snapshot0, 1
□ restore 結果を dump full して、(*1) と比較。


--------------------------------------------------------------------------------
vmbkp (java) コードの環境依存テストにおけるチェックリスト。
--------------------------------------------------------------------------------

テスト用 vm を ctkEnabled = false で用意し、
□ full バックアップ動作の確認
□ diff バックアップ動作の確認
□ 停止中の VM に対し、バックアップを連続で二回取って(二つとも同じ結果)動作確認。
□ ConfigGlobal.keep_generations の数が keep されること(最古世代が消えること)を確認。
□ 最新世代にエラー終了フラグを立てて、full バックアップに回帰することを確認。

テスト用 vm を ctkEnabled = true で用意し、
□ incr バックアップ動作の確認
□ 停止中の VM に対し、バックアップを連続で二回取って動作確認。
□ 最新世代にエラー終了フラグを立てて、full バックアップに回帰することを確認。

上記バックアップの結果生成されたアーカイブの任意世代について、
□ 新しい vm としてレストアできることを確認。
□ レストアされた VM を full バックアップし、同じ構成、vmdk であることを確認。
□ エラーフラグを立てて、レストアが失敗することを確認。

VM 構成パラメータ(cpu), (memory), nic, controller-disk map を変化させた
いくつかのパターンを作成し、それら全てについて、
□ full バックアップの動作確認。
□ レストアの動作確認。
□ レストア後の構成がバックアップ元と同じであることを確認。


--------------------------------------------------------------------------------
テスト運用開始時のチェックリスト。
--------------------------------------------------------------------------------

□ 運用中の全 vm に対して full バックアップが正常に取れたかを確認。
□ 上記アーカイブを別の vm 名をつけてレストアし、正常終了することを確認。
□ レストアされた vm を full バックアップし、同じアーカイブが生成されることを確認。


--------------------------------------------------------------------------------
テスト運用中のチェックリスト。
--------------------------------------------------------------------------------

□ 差分(増分)バックアップが正常終了しているかどうか確認。
□ vmdkbkp での check コマンドが正常終了することを確認。
□ 任意の generation について、dump + rdiff == previous dump であることを確認。
□ keep_generations = 3 にしておいて、4 回目のバックアップ時に、最古世代が消えることを確認。
